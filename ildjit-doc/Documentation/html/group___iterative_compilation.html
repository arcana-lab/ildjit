<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>ILDJIT: Iterative compilation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ildjit_logo_small.jpeg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ILDJIT
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Iterative compilation<div class="ingroups"><a class="el" href="group___plugins.html">Plugins</a> &raquo; <a class="el" href="group___optimizationleveltools.html">Optimization level tools</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Iterative compilation:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group___iterative_compilation.png" border="0" alt="" usemap="#group______iterative__compilation"/>
<map name="group______iterative__compilation" id="group______iterative__compilation">
<area shape="rect" id="node2" href="group___optimizationleveltools.html" title="Optimization level\l tools" alt="" coords="5,5,129,47"/></map>
</td></tr></table></center>
</div>
<p>The iterative compilation allows you to re-generate the IR code starting from an already generated one.</p>
<p>Following we describe how to use the iterative compilation.</p>
<p><br />
</p>
<hr/>
<p> <b> Generating the IR code </b> </p><hr/>
<p> The first step is to generate the IR code by using a static compilation scheme; for example <a class="el" href="group___partial_compilation_scheme.html">Partial compilation scheme</a> .</p>
<p>At this point, the program is available in its IR representation.</p>
<p><br />
</p>
<hr/>
<p> <b> Executing the code without iterative compilation </b> </p><hr/>
<p> Without using the iterative compilation, if you try to run ILDJIT with a static compilation scheme, the previously generated IR will be loaded from the disk, the machine code will be generated starting from that IR and its execution will start. </p><div class="fragment"><div class="line">$ ildjit --aot -x myProgram.cil</div>
</div><!-- fragment --><p> Therefore, by running the above command, no change will be performed to the generated code compared to the previous run.</p>
<p>Even by specifying different optimization level, the result will be the same as the default semantic of the aot compilation scheme is: if the IR code is available, use it without changing it. </p><div class="fragment"><div class="line">$ ildjit --aot -x -O3 myProgram.cil</div>
</div><!-- fragment --><p>In order to enable machine-dependent optimizations, you can use the <code> -M </code> option. In this case, the translation from the loaded IR to the machine code will use these optimizations because they are performed in the backend rather than at the IR level. </p><div class="fragment"><div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p>If you want to know the time spent running the program, you can use the internal profiler of ILDJIT, by executing the following command: </p><div class="fragment"><div class="line">   $ ildjit --aot -x -O3 -M -p1 myProgram.cil</div>
<div class="line"><span class="preprocessor">   #########################################################################</span></div>
<div class="line">                  PROFILING</div>
<div class="line"><span class="preprocessor">   #########################################################################</span></div>
<div class="line">Profiling clockID = CLOCK_PROCESS_CPUTIME_ID</div>
<div class="line">Garbage Collector used  = Allocator</div>
<div class="line">Methods translation</div>
<div class="line">        Total methods considered                      = 254</div>
<div class="line">        Total <span class="keyword">internal</span> methods                          = 11</div>
<div class="line">        Total methods translated                      = 33</div>
<div class="line">        Methods translated <span class="keyword">using</span> high priority                 = 0</div>
<div class="line">        Methods moved to high priority                         = 0</div>
<div class="line">        Total reprioritization                                 = 0</div>
<div class="line">        Total checkpointing                                    = 0</div>
<div class="line">        Trampolines taken</div>
<div class="line">         Before starting the execution of the entry point = 0</div>
<div class="line">         After starting the execution of the entry point  = 28</div>
<div class="line">        Static methods executed                                = 4</div>
<div class="line"></div>
<div class="line">Types</div>
<div class="line">         Types loaded                                 = 96</div>
<div class="line"></div>
<div class="line">Total time:</div>
<div class="line">         CPU Time = 0.077625 seconds</div>
<div class="line">         Wall Time         = 0.077511 seconds</div>
<div class="line"></div>
<div class="line">Compilation overhead:</div>
<div class="line">                  CPU Time = 0.109084 seconds</div>
<div class="line">                  CPU Time percent: 99.526370</div>
<div class="line">                  Wall Time         = 0.109323 seconds</div>
<div class="line">                  Wall Time percent: 99.941510</div>
<div class="line">Time spent executing the machine code generated:</div>
<div class="line">                  CPU Time =  0.031504 seconds</div>
<div class="line">                  CPU Time percent:  0.00001</div>
<div class="line">                  Wall Time         =  0.031837 seconds</div>
<div class="line">                  Wall Time percent: 0.00001</div>
</div><!-- fragment --><p><br />
</p>
<hr/>
<p> <b> Re-generate the IR code </b> </p><hr/>
<p> In order to modify the IR code, we can use the iterative compilation implemented by the plugin <code> optimization_levels-default </code>.</p>
<p>To enable the iterative compilation, you need to set the environment variable <code>ILDJIT_ITERATIVE_OPTIMIZATIONS</code> . </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
</div><!-- fragment --><p>Now you can re-generate the IR by running: </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
<div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p> The optimizations defined in the <code> PostAOT </code> level of the plugin <code> optimization_levels-default </code> are invoked.</p>
<p>The plugin defines different possible set of optimizations for the PostAOT level, which can be chosen by using environment variables. Without setting any additional variable, the level specified as input is used (i.e., O3 in the above example).</p>
<p>In order to enable the optimization <code> CUSTOM </code> implemented by the codetool <code> optimizer-dummy </code> designed to be the starting point for new code analyses and transformations, you can set the following environment variable: </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
<div class="line">$ export ILDJIT_CUSTOM_OPTIMIZATION=1</div>
<div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p> In this case, first the IR is loaded from the disk, then the level O3 is applied to it. The new optimized IR is the input of the CUSTOM optimization. At this point the IR is generated and optimized. Then, due to the <code> -M </code> option, the machine-dependent optimizations are applied at a lower level by using the installed backend (e.g. LLVM). The machine code is generated and installed in memory. Finally, the code is executed.</p>
<p>If the following environment variable is used, the method inliner and the function pointer elimination are applied to the code as well: </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
<div class="line">$ export ILDJIT_AGGRESSIVE_OPTIMIZATIONS=1</div>
<div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p> Notice that these two optimizations have not been released yet. However, you can change the set of <em> aggressive optimizations </em> by customizing the plugin <code> optimization_levels-default </code>.</p>
<hr/>
<p> <b> Save the new IR code </b> </p><hr/>
<p> Up to this point, nothing we did lead to substitute the IR stored in the disk. The IR was loaded and modified before generating the machine code.</p>
<p>However, you can save the new IR by setting the following environment variables: </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
<div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS_SAVE_PROGRAM=1</div>
<div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p> You can use all possible combination of environment variables to generate the new IR before storing it to the disk. For example: </p><div class="fragment"><div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS=1</div>
<div class="line">$ export ILDJIT_CUSTOM_OPTIMIZATION=1</div>
<div class="line">$ export ILDJIT_ITERATIVE_OPTIMIZATIONS_SAVE_PROGRAM=1</div>
<div class="line">$ ildjit --aot -x -O3 -M myProgram.cil</div>
</div><!-- fragment --><p> In this case, the following actions are performed in the following order: </p><ul>
<li>
the IR is loaded from the disk (let called this IR, IR0) </li>
<li>
IR0 is transformed by using the optimizations defined in the level <code> O3 </code> generating IR1 </li>
<li>
IR1 is transformed by the codetool that provides the <code> CUSTOM </code> optimization (e.g. <code> optimizer-dummy </code>) generating IR2 </li>
<li>
IR2 is stored in the disk substituting the previously stored IR0 </li>
<li>
IR2 is given as input to the backend (e.g. LLVM) </li>
<li>
Machine-dependent optimizations are used to generate the machine code </li>
<li>
The machine code is installed in memory </li>
<li>
The execution of the installed code starts </li>
</ul>
<p>After saving the new IR into the IR code cache, you can now measure the time spent running the new code by following the conventional way. </p><div class="fragment"><div class="line">$ unset ILDJIT_ITERATIVE_OPTIMIZATIONS ;</div>
<div class="line">$ unset ILDJIT_ITERATIVE_OPTIMIZATIONS_SAVE_PROGRAM=1 ;</div>
<div class="line">$ unset ILDJIT_CUSTOM_OPTIMIZATION=1 ;</div>
<div class="line">$ ildjit --aot -x -O3 -M -p1 myProgram.cil</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 30 2014 10:00:57 for ILDJIT by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
