<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>ILDJIT: Codetools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ildjit_logo_small.jpeg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ILDJIT
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Codetools<div class="ingroups"><a class="el" href="group___plugins.html">Plugins</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Codetools:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group___i_r_code_optimization.png" border="0" alt="" usemap="#group______i__r__code__optimization"/>
<map name="group______i__r__code__optimization" id="group______i__r__code__optimization">
<area shape="rect" id="node1" href="group___i_r_debugging.html" title="Debugging" alt="" coords="263,5,346,32"/><area shape="rect" id="node2" href="group___i_r_plugin_execution_model.html" title="Execution model" alt="" coords="247,56,363,83"/><area shape="rect" id="node3" href="group___plugins.html" title="Plugins" alt="" coords="5,31,71,57"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group___i_r_plugin_execution_model"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___i_r_plugin_execution_model.html">Execution model</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___i_r_debugging"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___i_r_debugging.html">Debugging</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>ILDJIT is distributed with a set of plugins we have developed and tested. This set includes the most common code analysis and optimizations like available expressions analysis and copy propagation code transformation. Every package called </p><div class="fragment"><div class="line">optimizer-ANYTHING</div>
</div><!-- fragment --><p> is an external plugin, loaded automatically by ILDJIT, in charge to analyze or transform IR methods.</p>
<p>This section describes how to execute ILDJIT IR code optimization plugins and how to debug the IR code they produce.</p>
<hr/>
<p> <b> Add a new plugin </b> </p><hr/>
<p>If you want to start a new plugin, you need to download the plugin called </p><div class="fragment"><div class="line">optimizer-dummy</div>
</div><!-- fragment --><p> from the official ILDJIT website (i.e., <a href="http://ildjit.sourceforge.net">http://ildjit.sourceforge.net</a>). From the <code> optimizer-dummy </code> plugin, you need to implement the stub functions you can find within it in order to implement and evaluate your specific customization of ILDJIT.</p>
<p>In order to use a plugin, it has to be invoked by ILDJIT. This is done inside the <code> libiljitiroptimizer/src/optimization_levels.c </code> file.</p>
<p>This file contains a bunch of functions, named <code> optimizeMethod_O0 </code> , <code> optimizeMethod_O1 </code> , <code> optimizeMethod_O2 </code> , and so on, each corresponding to a different optimization level of the compiler. Each optimization level includes all of the preceding ones.</p>
<p>Level 0 means no optimizations at all. <br />
Level 1 activates the most basic, fully functional and well tested optimizations available. Currently this set is composed by (and they are called in this strict order) </p><ul>
<li>
constant propagation (i.e., <code> <a class="el" href="group___codetools.html#ga4f447da4979d38f4dc1f1428c3b84385">CONSTANT_PROPAGATOR</a> </code>) </li>
<li>
copy propagation (i.e., <code> <a class="el" href="group___codetools.html#ga6dca83b55e7f1d3f611a00423fbacc30">COPY_PROPAGATOR</a> </code>) </li>
<li>
common sub-expressions elimination (i.e., <code> <a class="el" href="group___codetools.html#gae27316897f64de5a87be12a754f2f891">COMMON_SUBEXPRESSIONS_ELIMINATOR</a> </code>) </li>
<li>
dead-code elimination (i.e., <code> <a class="el" href="group___codetools.html#gadadbd1b617db8609aff13f7a71ed1505">DEADCODE_ELIMINATOR</a> </code>) </li>
<li>
null checks elimination (i.e., <code> <a class="el" href="group___codetools.html#gad1a43d2600dc9b1495b3f5d032aa316c">NULL_CHECK_REMOVER</a> </code>) </li>
<li>
instruction scheduler (i.e., <code> <a class="el" href="group___codetools.html#gac17f4b56512821956a10a9bb4f9e2c08">INSTRUCTIONS_SCHEDULER</a> </code>) </li>
<li>
algebraic simplification (i.e., <code> <a class="el" href="group___codetools.html#ga74c3d3e06a7175dbfea7c0a7345ee8b1">ALGEBRAIC_SIMPLIFICATION</a> </code>) </li>
</ul>
<p>Level 2 repeatedly invokes the optimizations of level 1, until a fixed point is reached (i.e., no more modification are made to the code by further invocations of level 1 optimizations).<br />
Moreover it calls the following additional code transformations: </p><ul>
<li>
Inline native methods (i.e., <code> <a class="el" href="group___codetools.html#ga82cf7c7bedcb29b782a417fdd24d49be">NATIVE_METHODS_ELIMINATION</a> </code>) </li>
<li>
Inline native methods (i.e., <code> <a class="el" href="group___codetools.html#ga0d273617f2c9e29ae09497ebf43a57da">CONVERSION_MERGING</a> </code>) </li>
<li>
Variables renaming (i.e., <code> <a class="el" href="group___codetools.html#ga70ccdd9f814cfd55e1008f61fdfec3bd">VARIABLES_RENAMING</a> </code>); </li>
</ul>
<p>Level 3 is equal to Level 2 plus calling the CUSTOM plugin (the default job type of the plugin <code> optimizer-dummy </code>). It means that if you do not change the job type of your plugin, it will be called within the level 3.<br />
Level 4 and following levels activate further, more advanced, optimizations.</p>
<hr/>
<p> <b> Plugin Dependencies </b> </p><hr/>
<p>Every code transformation has its own dependencies with other plugins (code analysis). For example a dead-code eliminator plugin (i.e., <code> <a class="el" href="group___codetools.html#gadadbd1b617db8609aff13f7a71ed1505">DEADCODE_ELIMINATOR</a> </code>) has the variable liveness and basic block analysis (i.e., <code> <a class="el" href="group___codetools.html#ga99c5de6b86e22a85cba729bfc8ef4449">LIVENESS_ANALYZER</a> </code>, <code> <a class="el" href="group___codetools.html#ga80de24e5cedcff2b0dcaa0abb880ff12">BASIC_BLOCK_IDENTIFIER</a> </code>) as dependences. The dead-code eliminator plugin has to declare this dependence setting to 1 the bit of <code> <a class="el" href="group___codetools.html#ga99c5de6b86e22a85cba729bfc8ef4449">LIVENESS_ANALYZER</a> </code> of the variable returned by its own function <code> get_dependences </code>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> JITUINT64 get_dependences (<span class="keywordtype">void</span>){</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="group___codetools.html#ga99c5de6b86e22a85cba729bfc8ef4449">LIVENESS_ANALYZER</a> | <a class="code" href="group___codetools.html#ga80de24e5cedcff2b0dcaa0abb880ff12">BASIC_BLOCK_IDENTIFIER</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> When ILDJIT boosts, it will check these dependencies and it ensures they are satisfied (they are called) before calling a given plugin.</p>
<hr/>
<p> <b> Compile, Install and Execute a new plugin </b> </p><hr/>
<p>In order to execute a plugin, you need to add a line like the following one: </p><div class="fragment"><div class="line">internal_callMethodOptimization (lib, method, irLib, <a class="code" href="group___codetools.html#gadadbd1b617db8609aff13f7a71ed1505">DEADCODE_ELIMINATOR</a>);</div>
</div><!-- fragment --><p> This line has to be added within the file <code> libiljitiroptimizer/src/optimization_levels.c </code>, in the exact point of the execution where you want your plugin to run. Notice that <code> <a class="el" href="group___codetools.html#gadadbd1b617db8609aff13f7a71ed1505">DEADCODE_ELIMINATOR</a> </code> has to be substituted with the ID of the plugin to run. The ID is the same that appears in the <code> get_ID_job </code> function of the plugin you want to run. Even if you could call your plugin from every point, we suggest to insert this line within the function optimizeMethod_O3 in order to have a clean and easy manageable input code of your plugin.</p>
<p>After modifying the file <code> optimization_levels.c </code>, you need to recompile and install the <code> libiljitiroptimizer </code> module by running: </p><div class="fragment"><div class="line">make &amp;&amp; make install</div>
</div><!-- fragment --><p>Now you are ready to execute ILDJIT with your new optimization plugin. For this purpose, ILDJIT has to be started activating the right optimization level. For example, if you added your plugin in optimization level 3 and you want to run it on testprogram.exe, then you will have to run: </p><div class="fragment"><div class="line">iljit -O3 testprogram.exe</div>
</div><!-- fragment --><p> This is sufficient to have your plugin working.</p>
<hr/>
<p> <b> Testing a new plugin </b> </p><hr/>
<p>When testing new plugins, the best thing to do is usually to insert the following call </p><div class="fragment"><div class="line"><a class="code" href="group___invoke_codetools.html#ga4e6f2b9247140cd4be46cfc42e3b047b">IROPTIMIZER_callMethodOptimization</a>(lib, method, <a class="code" href="group___codetools.html#gab8cdb84c8212a30119375ff4370069f8">METHOD_PRINTER</a>);</div>
</div><!-- fragment --><p> as a first and last instruction within the function <code> do_job </code> of the plugin that is in testing. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> do_job (<a class="code" href="structir__method__t.html">ir_method_t</a> *method){</div>
<div class="line">     <a class="code" href="group___invoke_codetools.html#ga4e6f2b9247140cd4be46cfc42e3b047b">IROPTIMIZER_callMethodOptimization</a>(lib, method, <a class="code" href="group___codetools.html#gab8cdb84c8212a30119375ff4370069f8">METHOD_PRINTER</a>);</div>
<div class="line">     ...</div>
<div class="line">     <a class="code" href="group___invoke_codetools.html#ga4e6f2b9247140cd4be46cfc42e3b047b">IROPTIMIZER_callMethodOptimization</a>(lib, method, <a class="code" href="group___codetools.html#gab8cdb84c8212a30119375ff4370069f8">METHOD_PRINTER</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p> In this way, you can check the input and output of the plugin in testing.</p>
<p>Moreover, it is a good practice to call a new plugin after the level O2, for example by running ildjit with the -O3 parameter, because the code will be simplified by the optimizations in O2, and then just the plugin to be tested will be executed, showing whether it works correctly or not.</p>
<p>Next: <a class="el" href="group___i_r_plugin_execution_model.html">Execution model</a> </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 30 2014 10:00:57 for ILDJIT by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
